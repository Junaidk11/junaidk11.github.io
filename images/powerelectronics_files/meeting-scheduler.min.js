function constructDefaultUserSlot(e,t,a){var r=0,m=moment.tz(a,"YYYY-MM-DD HH:mm:ss Z",t);m.isSame(e.clone(),"days")&&(m.minute()>30?r=parseInt(m.hours()+1+"00"):m.minute()>0&&m.minute()<30&&(r=parseInt(m.hours()+"30")));var o=e.format(userDateFormat),i=[];for(r;r<2360;r+=30){r,(r-60)%100==0&&(r=r-60+100);var n=e.clone();n.set({hour:r/100,minute:r%100,second:0,millisecond:0}),i.push(n)}defaultUserSlot[o]=i}function getProperAgentMeetingAvailabilityTimeDetails(e){for(var t in e){var a=Object.keys(e[t]);if(a.length>0){var r=meetingDayInNumber(a[0]);if(void 0!==r){if(r<=6)agentMeetingAvailability.push({date:null,dayNumber:r,from:e[t][a[0]].from,to:e[t][a[0]].to});else if(7==r)for(var m=0;m<7;m++)agentMeetingAvailability.push({date:null,dayNumber:m,from:e[t][a[0]].from,to:e[t][a[0]].to});else if(8==r)agentMeetingAvailability.push({date:null,dayNumber:0,from:e[t][a[0]].from,to:e[t][a[0]].to}),agentMeetingAvailability.push({date:null,dayNumber:6,from:e[t][a[0]].from,to:e[t][a[0]].to});else if(9==r)for(var m=1;m<6;m++)agentMeetingAvailability.push({date:null,dayNumber:m,from:e[t][a[0]].from,to:e[t][a[0]].to})}else agentMeetingAvailability.push({date:a[0],dayNumber:meetingDayInNumber(dayName(moment(a[0],userDateFormat).day())),from:e[t][a[0]].from,to:e[t][a[0]].to})}}agentMeetingAvailability=agentMeetingAvailability.sort(function(e,t){var a=e.dayNumber,r=t.dayNumber,m=moment(e.from,"HH:mm"),o=moment(t.from,"HH:mm");return a==r?m<o?-1:m>o?1:0:a<r?-1:1})}function convertAgentAvailToUserAvail(e,t,a){if(agentAvailabityUserTimeZone=[],e.length){for(i=0;i<e.length;i++)if(null==e[i].date){var r,m,o=moment.tz(a,"YYYY-MM-DD HH:mm:ss Z",agentTimeZone).format(userDateFormat),n=moment.tz(o+" "+e[i].from,userDateFormatWithHHMM,agentTimeZone).format(userDateFormat),s=moment.tz(o+" "+e[i].to,userDateFormatWithHHMM,agentTimeZone).format(userDateFormat),l=timeZoneConversion(o+" "+e[i].from,agentTimeZone,t,userDateFormatWithHHMM),u=timeZoneConversion(o+" "+e[i].to,agentTimeZone,t,userDateFormatWithHHMM),d=l.format(userDateFormat),f=u.format(userDateFormat);if(moment(d,userDateFormat).isSame(moment(n,userDateFormat),"day")&&moment(f,userDateFormat).isAfter(moment(s,userDateFormat),"day"))m=e[i].dayNumber,r={date:null,to:"23:59",from:l.format("HH:mm"),dayNumber:m},agentAvailabityUserTimeZone.push(r),m=++m%7,r={date:null,to:u.format("HH:mm"),from:"0:00",dayNumber:m},agentAvailabityUserTimeZone.push(r);else if(moment(d,userDateFormat).isBefore(moment(n,userDateFormat),"day")&&moment(f,userDateFormat).isSame(moment(s,userDateFormat),"day"))m=e[i].dayNumber,0===m&&(m=7),m--,r={date:null,to:"23:59",from:l.format("HH:mm"),dayNumber:m},agentAvailabityUserTimeZone.push(r),r={date:null,to:u.format("HH:mm"),from:"0:00",dayNumber:e[i].dayNumber},agentAvailabityUserTimeZone.push(r);else if(moment(d,userDateFormat).isBefore(moment(n,userDateFormat),"day")&&moment(f,userDateFormat).isBefore(moment(s,userDateFormat),"day")&&moment(d,userDateFormat).isSame(moment(f,userDateFormat),"day"))m=e[i].dayNumber,0===m&&(m=7),m--,r={date:null,to:u.format("HH:mm"),from:l.format("HH:mm"),dayNumber:m},agentAvailabityUserTimeZone.push(r);else if(moment(d,userDateFormat).isAfter(moment(n,userDateFormat),"day")&&moment(f,userDateFormat).isAfter(moment(s,userDateFormat),"day")&&moment(d,userDateFormat).isSame(moment(f,userDateFormat),"day")){m=e[i].dayNumber,m=++m%7;var r={date:null,to:u.format("HH:mm"),from:l.format("HH:mm"),dayNumber:m};agentAvailabityUserTimeZone.push(r)}else r=e[i],r.from=l.format("HH:mm"),r.to=u.format("HH:mm"),agentAvailabityUserTimeZone.push(r)}else if(e[i].date){var n=moment.tz(e[i].date+" "+e[i].from,userDateFormatWithHHMM,agentTimeZone),s=moment.tz(e[i].date+" "+e[i].to,userDateFormatWithHHMM,agentTimeZone),y=n.clone().tz(t),c=s.clone().tz(t);y.set({second:0,millisecond:0}),c.set({second:0,millisecond:0}),y.isSame(c,"day")?(r={date:y.format(userDateFormat),from:y,to:c,dayNumber:y.day()},agentAvailabityUserTimeZone.push(r)):y.isBefore(c,"day")&&(r={date:y.format(userDateFormat),from:y,to:c.clone().set({hours:23,minute:59,second:0}),dayNumber:y.day()},agentAvailabityUserTimeZone.push(r),r={date:y.format(userDateFormat),from:y.clone().set({hours:0,minute:0,second:0}),to:c,dayNumber:c.day()},agentAvailabityUserTimeZone.push(r))}agentAvailabityUserTimeZone=agentAvailabityUserTimeZone.sort(function(e,t){var a=e.dayNumber,r=t.dayNumber,m=moment(e.from,"HH:mm"),o=moment(t.from,"HH:mm");return a==r?m<o?-1:m>o?1:0:a<r?-1:1})}}function getAvailabilitySlots(e,t,a,r,m,o){var i=$(t).attr("dateAttr"),n=!1;if(o.length>0&&o.includes(i)&&(availabilitySlot[i]=[],defaultUserSlot[i]=[],n=!0),e.length>0){var s=moment.tz(i,userDateFormat,r),l=s.day(),u=e.filter(function(e,t){if(e.dayNumber==l)return e}),d=u.filter(function(e,t){if(e.date==i)return e});if(d.length>0)var f=d;else var f=u;availabilitySlot[i]=[],defaultUserSlot[i].forEach(function(e,t){var a=e.clone().tz(agentTimeZone),r=meetingCountsPerDate[a.format(userDateFormat)];(void 0==r||r<parseInt(maxMeetingsCount))&&f.forEach(function(t,a){if(null==t.date){var r=e.clone(),m=r.clone().set({hour:t.from.split(":")[0],minute:t.from.split(":")[1],second:0,millisecond:0});currentDateTo=r.clone().set({hour:t.to.split(":")[0],minute:t.to.split(":")[1],second:0,millisecond:0}),r.isBetween(m,currentDateTo,null,"[)")&&-1===availabilitySlot[i].indexOf(e)&&availabilitySlot[i].push(e)}else if(t.date){var r=e.clone();moment(r.format()).isBetween(t.from.format(),t.to.format(),null,"[)")&&-1===availabilitySlot[i].indexOf(e)&&availabilitySlot[i].push(e)}})}),availabilitySlotPerDate=availabilitySlot[i],availabilitySlotPerDate.length>0?(void 0==a&&null==a||removeScheduledSlots(a,availabilitySlotPerDate,r,t),0===availabilitySlotPerDate.length?n=!0:(manageMinimumScheduleNotice(availabilitySlotPerDate,r,m),0===availabilitySlotPerDate.length&&(n=!0))):n=!0,!0===n&&disableDate(t)}}function removeScheduledSlots(e,t,a){e.forEach(function(e){var r=moment.tz(1e3*e.scheduled_timestamp,a),m=parseInt(bufferTime),o=r.clone().add(e.duration,"minutes").add(m,"minutes");parseInt(o.format("HH:mm").split(":")[1])>30?o=o.add(60-o.minutes(),"minutes"):parseInt(o.format("HH:mm").split(":")[1])>0&&parseInt(o.format("HH:mm").split(":")[1])<30&&(o=o.add(30-o.minutes(),"minutes"));var i=o;i.set({second:0,millisecond:0});var n=r.clone().subtract(parseInt(currentSlotDuration),"minutes").subtract(m,"minutes");parseInt(n.format("HH:mm").split(":")[1])>30?n=n.add(60-n.minutes(),"minutes"):parseInt(n.format("HH:mm").split(":")[1])>0&&parseInt(n.format("HH:mm").split(":")[1])<30&&(n=n.add(30-n.minutes(),"minutes"));var s=n;s.set({second:0,millisecond:0});for(var l=0;l<t.length;l++)t[l].isBetween(s,i,null,"[)")&&(t.splice(l,1),l--)})}function manageMinimumScheduleNotice(e,t,a){var r=moment.tz(a,"YYYY-MM-DD HH:mm:ss Z",t),m=r.add(parseInt(minScheduleNotice),"minutes");m.set({second:0,millisecond:0});for(var o=0;o<e.length;o++)e[o].isSameOrBefore(m)&&(e.splice(o,1),o--)}function dayName(e){var t;switch(e){case 0:case 10:t="Sunday";break;case 1:case 11:t="Monday";break;case 2:case 12:t="Tuesday";break;case 3:case 13:t="Wednesday";break;case 4:case 14:t="Thursday";break;case 5:case 15:t="Friday";break;case 6:case 16:t="Saturday"}return t}function meetingDayInNumber(e){var t;switch(e){case"All Sundays":t=0;break;case"All Mondays":t=1;break;case"All Tuesdays":t=2;break;case"All Wednesdays":t=3;break;case"All Thursdays":t=4;break;case"All Fridays":t=5;break;case"All Saturdays":t=6;break;case"Everyday":t=7;break;case"Weekends":t=8;break;case"Weekdays":t=9;break;case"Sunday":t=10;break;case"Monday":t=11;break;case"Tuesday":t=12;break;case"Wednesday":t=13;break;case"Thursday":t=14;break;case"Friday":t=15;break;case"Saturday":t=16}return t}function timeZoneConversion(e,t,a,r,m){return moment.tz(e,r,t).clone().tz(a)}var getDaysBetweenDates=function(e,t){for(var a=[];e.diff(t)<0;)a.push(e.clone()),e.add(1,"days");return a};